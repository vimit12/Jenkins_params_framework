{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Deploy Service Pipeline Parameters",
  "type": "object",
  "properties": {
    "APP_NAME": {
      "type": "string",
      "minLength": 2,
      "description": "Logical name of the application"
    },
    "IMAGE_TAG": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9._-]+$",
      "description": "Docker image tag",
      "x-coerce": false
    },
    "ENV": {
      "type": "string",
      "enum": ["dev", "qa", "staging", "prod"],
      "description": "Target environment"
    },
    "RUN_TESTS": {
      "type": "boolean",
      "description": "Whether to run tests before deploy",
      "x-coerce": true
    },
    "REPLICAS": {
      "type": "integer",
      "minimum": 1,
      "maximum": 20,
      "description": "Number of replicas to run",
      "x-coerce": true
    },
    "CPU_LIMIT": {
      "type": "string",
      "pattern": "^[0-9]+m$",
      "description": "CPU limit, e.g. 500m"
    },
    "MEMORY_LIMIT": {
      "type": "string",
      "pattern": "^[0-9]+Mi$",
      "description": "Memory limit, e.g. 512Mi"
    },
    "ALLOW_PROD_DEPLOY": {
      "type": "boolean",
      "description": "Gate for production deployment",
      "x-coerce": true
    }
  },
  "required": [
    "APP_NAME",
    "IMAGE_TAG",
    "ENV"
  ],
  "additionalProperties": false,
  "x-validators": [
    "team_validators.deploy_rules:validate_deploy"
  ]
}